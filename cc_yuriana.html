<!DOCTYPE HTML>
<html lang="zh">
<head>
<title>王都綻放的白百合</title>
<script type="text/javascript"> 
function noNaN( n ) { return isNaN( n ) ? 0 : n; }
function calculate(){
	var himawari=parseInt(document.getElementById('himawari').value);
	if(himawari==0){var himawari1=0;}
	else if(himawari==1){var himawari1=2.1;}
	else if(himawari==2){var himawari1=2.3;}
	else if(himawari==3){var himawari1=2.5;}
	else if(himawari==4){var himawari1=2.7;}
	else {var himawari1=3;}
	//=IF(B3=0,0,IF(B3=1,2.1,IF(B3=2,2.3,IF(B3=3,2.5,IF(B3=4,2.7,3)))))
	
	var yuriana=parseInt(document.getElementById('yuriana').value);
	if(yuriana==0){var yuriana1=0;}
	else if(yuriana==1){var yuriana1=2.1;}
	else if(yuriana==2){var yuriana1=2.3;}
	else if(yuriana==3){var yuriana1=2.5;}
	else if(yuriana==4){var yuriana1=2.7;}
	else {var yuriana1=3;}
	
	var lily=parseInt(document.getElementById('lily').value);
	if(lily==0){var lily1=0;}
	else if(lily==1){var lily1=0.1;}
	else if(lily==2){var lily1=0.3;}
	else if(lily==3){var lily1=0.5;}
	else if(lily==4){var lily1=0.7;}
	else {var lily1=1;}
	//=IF(B5=0,0,IF(B5=1,0.1,IF(B5=2,0.3,IF(B5=3,0.5,IF(B5=4,0.7,1)))))
	
	var friend=parseInt(document.getElementById('friend').value);
	var friend1=2*friend;
	
	var ownssr=0;
	if(friend>0){ownssr=ownssr+1;}
	if(yuriana>0){ownssr=ownssr+1;}
	if(himawari>0){ownssr=ownssr+1;}
	
	if(document.getElementById("lily_weapon").value>7-ownssr){
		document.getElementById("lily_weapon").value=7-ownssr;
	}
	
	var lily_weapon=parseInt(document.getElementById('lily_weapon').value);
	var lily_weapon1=0.5*lily_weapon;
	
	var final1=1+yuriana1+himawari1+lily_weapon1+lily1+friend1;
	document.getElementById('final').value = final1.toFixed(2);
	
	var ring=Math.max(0,lily-1)*20+Math.min(240,lily_weapon*40);
	document.getElementById('ring').value = ring;
	
	var aim=noNaN(parseInt(document.getElementById('aim').value))-noNaN(parseInt(document.getElementById('hasnow').value));
	var mawari=noNaN(parseInt(document.getElementById('mawari').value));
	var maxap=noNaN(parseInt(document.getElementById('maxap').value));
	var restap=noNaN(parseInt(document.getElementById('restap').value));
	
	if (mawari==1){
		var per=25000; var ap=30;
		document.getElementById('manual').style.display="none";
	}
	else {
		document.getElementById('manual').style.display="inline";
		var per=noNaN(parseInt(document.getElementById('per').value));
		var ap=noNaN(parseInt(document.getElementById('ap').value));
	}
	
	var senkou1=per*final1;
	var times1=Math.ceil(aim*10000/senkou1,1);
	var needap1=times1*ap;
	var needapmrest1=needap1-restap;
	var need_fruit1=Math.ceil(needapmrest1/maxap,1);
	
	//var comp_critr=parseInt(document.getElementById('comp_critr').value);
	//if(comp_critr=="1"){var nolily1=1+yuriana1+himawari1+friend1+0.1;}
	//else{var nolily1=1+yuriana1+himawari1+friend1;}

	var comp_lily=parseInt(document.getElementById('comp_lily').value);
	if(comp_lily==0){var comp_lily1=0;}
	else if(comp_lily==1){var comp_lily1=0.1;}
	else if(comp_lily==2){var comp_lily1=0.3;}
	else if(comp_lily==3){var comp_lily1=0.5;}
	else if(comp_lily==4){var comp_lily1=0.7;}
	else {var comp_lily1=1;}

	if(document.getElementById("comp_weapon").value>7-ownssr){
		document.getElementById("comp_weapon").value=7-ownssr;
	}

	var comp_weapon=parseInt(document.getElementById('comp_weapon').value);
	var comp_weapon1=0.5*comp_weapon;

	var nolily1=1+yuriana1+himawari1+comp_weapon1+comp_lily1+friend1;
	
	var comp2=final1/nolily1;
	var senkou2=per*nolily1;
	var times2=Math.ceil(aim*10000/senkou2,1);
	var needap2=times2*ap;
	var needapmrest2=needap2-restap;
	var need_fruit2=Math.ceil(needapmrest2/maxap,1);
	var fruit=need_fruit2-need_fruit1;
	var ring2=Math.max(0,comp_lily-1)*20+Math.min(240,comp_weapon*40);
	var ringdiff=ring2-ring;
	
	document.getElementById('comp2').value = comp2.toFixed(4);
	document.getElementById('times1').value = times1;
	document.getElementById('times2').value = times2;
	document.getElementById('needap1').value = needap1;
	document.getElementById('needap2').value = needap2;
	document.getElementById('needapmrest1').value = needapmrest1;
	document.getElementById('needapmrest2').value = needapmrest2;
	document.getElementById('need_fruit1').value = need_fruit1;
	document.getElementById('need_fruit2').value = need_fruit2;
	if (fruit>=0){document.getElementById('fruit_diff').innerHTML = "+" + fruit;}
	else{document.getElementById('fruit_diff').innerHTML = fruit;}
	if (ringdiff>=0){document.getElementById('ring_diff').innerHTML = "+" + ringdiff;}
	else{document.getElementById('ring_diff').innerHTML = ringdiff;}
}; 
function settime(){
	var time_now=new Date().getTime();
	var time_end=new Date("2/2/2016 13:59:59 GMT+0800").getTime();
	var date=new Date();
	var time_d = Math.max(0,Math.floor((time_end-time_now)/1000/60/60/24));
	var time_h = Math.max(0,Math.floor((time_end-time_now)/1000/60/60)%24);
	var time_m = Math.max(0,Math.floor((time_end-time_now)/1000/60)%60);
	var time_s = Math.max(0,Math.floor((time_end-time_now)/1000)%60);
	document.getElementById("showTime").innerHTML = time_d + "天" + time_h + "时" + time_m + "分" + time_s + "秒";
};
window.onload = function(){ 
	document.getElementById('aim').value=2000;
	document.getElementById('hasnow').value=0;
	document.getElementById('per').value=25000;
	document.getElementById('ap').value=30;
	document.getElementById('maxap').value=90;
	
	var date=new Date().getTime();
	var date_end=new Date("2/2/2016 13:59:59 GMT+0800").getTime();
	var restap=Math.floor((date_end-date)/1000/60/8);
	document.getElementById('restap').value=restap;
	
	calculate();
	
	setInterval(settime, 1000);
}; 
</script> 
</head>

<body>

<p><b>王都綻放的白百合</b>　2016.1.26-2016.2.2</p>
<p>距離活動結束還有<span id="showTime"></span></p>

<p>
向日葵<select id="himawari" onchange=calculate()>
  <option value="0">沒有</option>
  <option value="1">0破</option>
  <option value="2">1破</option>
  <option value="3">2破</option>
  <option value="4">3破</option>
  <option value="5">滿破</option>
  </select></br>
聖王女<select id="yuriana" onchange=calculate()>
  <option value="0">沒有</option>
  <option value="1">0破</option>
  <option value="2">1破</option>
  <option value="3">2破</option>
  <option value="4">3破</option>
  <option value="5">滿破</option>
  </select></br>
朋友<select id="friend" onchange=calculate()>
  <option value="1">有</option>
  <option value="0">沒有</option>
  </select></br>
白百合<select id="lily" onchange=calculate()>
  <option value="0">沒有</option>
  <option value="1">0破</option>
  <option value="2">1破</option>
  <option value="3">2破</option>
  <option value="4">3破</option>
  <option value="5">滿破</option>
  </select></br>
倍武<select id="lily_weapon" onchange=calculate()>
  <option value="0">沒有</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  </select></br>
</p>
<p>
倍率：<output id="final"></output>　消耗戒指：<output id="ring"></output></br>
</p>
<p>
<b>通關後</b>：</br>
目標戰功<input type="text" id="aim" onkeyup=calculate() />萬</br>
已有戰功<input type="text" id="hasnow" onkeyup=calculate() />萬</br>
周回<select id="mawari" onchange=calculate()>
  <option value="1">王城の護り手</option>
  <option value="0">手動輸入</option>
  </select></br>
<span id="manual" style="display:none">　每場基本戰功<input type="text" id="per" onkeyup=calculate() /></br>
　每場ap<input type="text" id="ap" onkeyup=calculate() /></br></span>
最大ap<input type="text" id="maxap" onkeyup=calculate() /></br>
剩餘自然回體<input type="text" id="restap" onkeyup=calculate() /></br>
打<output id="times1"></output>場可畢業，需要ap：<output id="needap1"></output></br>
扣減自然回體後需要ap：<output id="needapmrest1"></output>，果：<output id="need_fruit1"></output></br>
</p>
<p>
與白百合<select id="comp_lily" onchange=calculate()>
  <option value="0">沒有</option>
  <option value="1">0破</option>
  <option value="2">1破</option>
  <option value="3">2破</option>
  <option value="4">3破</option>
  <option value="5">滿破</option>
  </select>倍武<select id="comp_weapon" onchange=calculate()>
  <option value="0">沒有</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  </select>比較，倍率為<output id="comp2"></output>倍</br>
<span style="display:none"><select id="comp_critr" onchange=calculate()>
  <option value="1">與「 0破白百合」&「無倍武」比較：</option>
  <option value="0">與「沒有白百合」&「無倍武」比較：</option>
  </select></br></span>
打<output id="times2"></output>場可畢業，需要ap：<output id="needap2"></output></br>
扣減自然回體後需要ap：<output id="needapmrest2"></output>，果：<output id="need_fruit2"></output></br>
戒指消耗<span id="ring_diff"></span>，ap果消耗<span id="fruit_diff"></output></br>
</p>
</body>
